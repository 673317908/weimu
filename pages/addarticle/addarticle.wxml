<!--
/*
 * 
 * 微慕小程序
 * author: jianbo
 * organization:  微慕 www.minapper.com 
 * 技术支持微信号：Jianbo
 * Copyright (c) 2018 https://www.minapper.com All rights reserved.
 *
 */-->
<import src="../../templates/login-popup.wxml" />


<view class="view-box">

  <form report-submit="true" catchsubmit="publishArticle">

    <view class="form-top">
      <!-- 分类 -->
      <view class="category">
        <view>
          <button class='btn-cancel' bindtap="cancelPublish">取消</button>
        </view>
        <view>
          <text class="cate" bindtap='categoryBtn'>{{ formData.categoryName ? formData.categoryName : '请选择分类' }}</text>
        </view>
        <view>
          <button class="btn-submit" formType="submit">提交</button>
        </view>
      </view>

      <!-- 标题 -->
      <view class='title'>
        <!-- <textarea value="{{formData.title}}" show-confirm-bar="{{false}}" placeholder='请输入标题' bindblur='bindTitle' placeholder-style="color: #aaa;" auto-height /> -->
        <input value="{{formData.title}}" placeholder='请输入标题' bindblur='bindTitle' placeholder-style="color: #aaa;" />
        
      </view>

      <!-- 正文 -->
      <view class="editor-box">
        <editor id="editor" class="editor" placeholder="请输入正文内容..." bindstatuschange="onStatusChange" bindready="onEditorReady" bindblur="onContentInput">
        </editor>
      </view>

      <!-- 编辑框工具栏 -->
      <view class="toolbar" catchtouchend="format" style="bottom: {{isIOS ? keyboardHeight : 0}}px">
        <view class="toolbar-row">
          <i class="iconfont icon-charutupian" catchtouchend="insertImage"></i>
          <i class="iconfont icon-format-header-1 {{formats.header === 1 ? 'ql-active' : ''}}" data-name="header" data-value="{{1}}"></i>
          <i class="iconfont icon-format-header-2 {{formats.header === 2 ? 'ql-active' : ''}}" data-name="header" data-value="{{2}}"></i>
          <i class="iconfont icon-format-header-3 {{formats.header === 3 ? 'ql-active' : ''}}" data-name="header" data-value="{{3}}"></i>
          <i class="iconfont icon-zitijiacu {{formats.bold ? 'ql-active' : ''}}" data-name="bold"></i>
          <i class="iconfont icon-zitixieti {{formats.italic ? 'ql-active' : ''}}" data-name="italic"></i>
          <i class="iconfont icon-zitixiahuaxian {{formats.underline ? 'ql-active' : ''}}" data-name="underline"></i>
          <i class="iconfont icon-zitishanchuxian {{formats.strike ? 'ql-active' : ''}}" data-name="strike"></i>
          <i class="iconfont icon-zitixiabiao {{formats.script === 'sub' ? 'ql-active' : ''}}" data-name="script" data-value="sub"></i>
        </view>

        <view class="toolbar-row">
          <i class="iconfont icon-zitishangbiao {{formats.script === 'super' ? 'ql-active' : ''}}" data-name="script" data-value="super"></i>
          <i class="iconfont icon-wuxupailie {{formats.list === 'bullet' ? 'ql-active' : ''}}" data-name="list" data-value="bullet"></i>
          <i class="iconfont icon-date" bindtap="insertDate"></i>
          <i class="iconfont icon-zuoduiqi {{formats.align === 'left' ? 'ql-active' : ''}}" data-name="align" data-value="left"></i>
          <i class="iconfont icon-juzhongduiqi {{formats.align === 'center' ? 'ql-active' : ''}}" data-name="align" data-value="center"></i>
          <i class="iconfont icon-youduiqi {{formats.align === 'right' ? 'ql-active' : ''}}" data-name="align" data-value="right"></i>
          <i class="iconfont icon-undo" bindtap="undo"></i>
          <i class="iconfont icon-redo" bindtap="redo"></i>
          <i class="iconfont icon-shanchu" bindtap="clear"></i>
        </view>
      </view>

    </view>

    <!-- 折叠内容 -->
    <view class="form-bottom" wx:if="{{isShowMore}}">
      <!-- 摘要 -->
      <view class='excerpt'>
        <textarea value="{{formData.excerpt}}" disable-default-padding="{{true}}" show-confirm-bar="{{false}}" placeholder='请输入摘要...' maxlength="-1" bindblur='bindExcerpt' placeholder-style="color:#AAA"></textarea>
      </view>

      <!-- 标签 -->
      <view class='tags'>
        <text class="label">标签</text>
        <view class="input">
          <input value="{{formData.tags}}" placeholder="请输入标签，多个以逗号隔开" placeholder-style="color:#AAA" bindblur="onTagInput" />
        </view>
      </view>

      <!-- 激励视频 -->
      <view class="paid-read-switch">
        <view>开启激励视频</view>
        <view>
          <switch disabled="{{isDisabledVideo}}" checked="{{isRewardedVideo}}" bindchange="openRewardedVideo" />
        </view>
      </view>

      <!-- 付费阅读 -->
      <view class="paid-read">
        <view class="paid-read-switch">
          <view>开启付费阅读</view>
          <view>
            <switch disabled="{{isDisabledPay}}" checked="{{isOPenPay}}" bindchange="openPay" />
          </view>
        </view>

        <view wx:if="{{isOPenPay}}" class="paid-read-input">
          <view class='paid-input-item'>
            <text class="label">金额</text>
            <view class="input">
              <input value="{{formData.price}}" type='digit' bindblur="bindprice" cursor-spacing="5" maxlength="100" name="price" placeholder="请输入" placeholder-style="color:#AAA" />
            </view>元
          </view>
          <view class='paid-input-item'>
            <text class="label">积分</text>
            <view class="input">
              <input value="{{formData.integral}}" type='number' bindblur="bindintegral" cursor-spacing="5" maxlength="100" name="integral" placeholder="请输入" placeholder-style="color:#AAA" />
            </view>分
          </view>
        </view>
      </view>

      <!-- 视频 -->
      <view class='video'>

        <!-- 上传视频 -->
        <view class="video-label">上传视频</view>
        <view wx:if="{{!formData.videoSrc}}" class="btn-upload-video" bindtap="add_video">点击上传视频</view>

        <block wx:if="{{formData.videoSrc}}">
          <video id="video" width="100%" show-mute-btn="false" controls="true" class="video" poster="{{formData.poster}}" src="{{formData.videoSrc}}" bindtouchstart="vtouchstart" bindtouchend="vtouchend" catchtap="del_video"></video>

          <view class="video-tip">长按可删除视频，点击下方上传按钮可上传视频封面</view>

          <view class="btn-video-pic" wx:if="{{!formData.video_poster}}" bindtap="add_video_poster"></view>

          <view class="video-pic" wx:if="{{formData.video_poster}}">
            <image src="{{formData.video_poster}}" mode="aspectFill" bindtouchstart="myVideotouchstart" bindtouchend="myVideotouchend" catchtap="del_video_poster"></image>
          </view>
        </block>


        <!-- 解析视频 -->
        <view class="video-label">解析视频</view>
        <block wx:if="{{!formData.vid}}">
          <view class="btn-upload-video " bindtap="parserLink">解析腾讯视频</view>
          <view class="video-resolve-tip">* 请从腾讯视频app上复制腾讯视频的链接，然后回到小程序里点击此按钮，程序会自动获取系统剪贴板的内容并解析</view>
          <!-- <textarea value="{{formData.vid}}" bindblur="onBindBlur" placeholder-style="color:#AAA" placeholder="请从app上复制腾讯视频的链接，粘贴到此处..." /> -->
        </block>

        <block wx:if="{{formData.vid}}">
          <txv-video id="qqvideo" wx:if="{{formData.vid}}" vid="{{formData.vid}}" playerid="playerid" width="100%" height="80%" autoplay="{{false}}" bindtouchstart="vlinktouchstart" bindtouchend="vlinktouchend" catchtap="del_link_video">
          </txv-video>
          <view class="video-tip">长按可删除视频</view>
        </block>
      </view>

    </view>

    <!-- 控制折叠按钮 -->
    <view class="btn-more" bindtap="addMore">
      <text wx:if="{{!isShowMore}}" class="down">展开</text>
      <text wx:else class="up">收缩</text>
    </view>

  </form>

</view>


<!-- 选择分类弹窗 -->
<l-popup show="{{showCategoryPop}}" content-align="right">
  <scroll-view scroll-y="true" class="category-popup">
    <view class="category-popup-header">选择分类</view>

    <!-- 分类列表 -->
    <view class="category-popup-content">
      <view class="content-item" wx:if="{{item.id !='0'}}" wx:for="{{columns}}" wx:key="index">

        <!-- 一级分类 -->
        <view catchtap="pickCategory" class="item-one" data-categoryid="{{item.id}}" data-categoryname="{{item.name}}">{{item.name}}</view>

        <!-- 子分类 -->
        <block wx:for="{{item.children}}" wx:for-item="itm" wx:for-index="idx" wx:key="idx">
          <view class="item-two" bindtap="pickSubCategory" data-categoryname="{{itm.name}}" data-categoryid="{{itm.id}}">{{itm.name}}</view>
        </block>

      </view>
    </view>

  </scroll-view>
</l-popup>

<!-- 提示框和模态框 -->
<l-toast />
<l-dialog />

<!-- 登录弹窗 -->
<template is="login-popup" data="{{show:isLoginPopup,userInfo:userInfo}}"></template>